This is really fragile. (For example, when pasting.) It will also break when text is just added at the end.

