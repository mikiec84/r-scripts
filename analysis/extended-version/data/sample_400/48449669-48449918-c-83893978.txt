this is basically a more complicated version of @rokkerboci answer

